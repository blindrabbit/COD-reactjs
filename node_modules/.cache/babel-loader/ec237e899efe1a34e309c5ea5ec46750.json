{"ast":null,"code":"import { operate } from '../util/lift';\nimport { OperatorSubscriber } from './OperatorSubscriber';\nexport function refCount() {\n  return operate(function (source, subscriber) {\n    var connection = null;\n    source._refCount++;\n    var refCounter = new OperatorSubscriber(subscriber, undefined, undefined, undefined, function () {\n      if (!source || source._refCount <= 0 || 0 < --source._refCount) {\n        connection = null;\n        return;\n      }\n\n      var sharedConnection = source._connection;\n      var conn = connection;\n      connection = null;\n\n      if (sharedConnection && (!conn || sharedConnection === conn)) {\n        sharedConnection.unsubscribe();\n      }\n\n      subscriber.unsubscribe();\n    });\n    source.subscribe(refCounter);\n\n    if (!refCounter.closed) {\n      connection = source.connect();\n    }\n  });\n}","map":{"version":3,"sources":["../../../../src/internal/operators/refCount.ts"],"names":[],"mappings":"AAGA,SAAS,OAAT,QAAwB,cAAxB;AACA,SAAS,kBAAT,QAAmC,sBAAnC;AA6DA,OAAM,SAAU,QAAV,GAAkB;AACtB,SAAO,OAAO,CAAC,UAAC,MAAD,EAAS,UAAT,EAAmB;AAChC,QAAI,UAAU,GAAwB,IAAtC;AAEC,IAAA,MAAc,CAAC,SAAf;AAED,QAAM,UAAU,GAAG,IAAI,kBAAJ,CAAuB,UAAvB,EAAmC,SAAnC,EAA8C,SAA9C,EAAyD,SAAzD,EAAoE,YAAA;AACrF,UAAI,CAAC,MAAD,IAAY,MAAc,CAAC,SAAf,IAA4B,CAAxC,IAA6C,IAAI,EAAG,MAAc,CAAC,SAAvE,EAAkF;AAChF,QAAA,UAAU,GAAG,IAAb;AACA;AACD;;AA2BD,UAAM,gBAAgB,GAAI,MAAc,CAAC,WAAzC;AACA,UAAM,IAAI,GAAG,UAAb;AACA,MAAA,UAAU,GAAG,IAAb;;AAEA,UAAI,gBAAgB,KAAK,CAAC,IAAD,IAAS,gBAAgB,KAAK,IAAnC,CAApB,EAA8D;AAC5D,QAAA,gBAAgB,CAAC,WAAjB;AACD;;AAED,MAAA,UAAU,CAAC,WAAX;AACD,KAxCkB,CAAnB;AA0CA,IAAA,MAAM,CAAC,SAAP,CAAiB,UAAjB;;AAEA,QAAI,CAAC,UAAU,CAAC,MAAhB,EAAwB;AACtB,MAAA,UAAU,GAAI,MAAmC,CAAC,OAApC,EAAd;AACD;AACF,GApDa,CAAd;AAqDD","sourceRoot":"","sourcesContent":["import { operate } from '../util/lift';\r\nimport { OperatorSubscriber } from './OperatorSubscriber';\r\nexport function refCount() {\r\n    return operate(function (source, subscriber) {\r\n        var connection = null;\r\n        source._refCount++;\r\n        var refCounter = new OperatorSubscriber(subscriber, undefined, undefined, undefined, function () {\r\n            if (!source || source._refCount <= 0 || 0 < --source._refCount) {\r\n                connection = null;\r\n                return;\r\n            }\r\n            var sharedConnection = source._connection;\r\n            var conn = connection;\r\n            connection = null;\r\n            if (sharedConnection && (!conn || sharedConnection === conn)) {\r\n                sharedConnection.unsubscribe();\r\n            }\r\n            subscriber.unsubscribe();\r\n        });\r\n        source.subscribe(refCounter);\r\n        if (!refCounter.closed) {\r\n            connection = source.connect();\r\n        }\r\n    });\r\n}\r\n//# sourceMappingURL=refCount.js.map"]},"metadata":{},"sourceType":"module"}